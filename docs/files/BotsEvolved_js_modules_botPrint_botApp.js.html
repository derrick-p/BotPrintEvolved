<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>BotsEvolved/js/modules/botPrint/botApp.js - The BotPrint API</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="The BotPrint API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/App.html">App</a></li>
            
                <li><a href="../classes/BrainEvo.html">BrainEvo</a></li>
            
                <li><a href="../classes/Collision.html">Collision</a></li>
            
                <li><a href="../classes/Coords.html">Coords</a></li>
            
                <li><a href="../classes/Draggable.html">Draggable</a></li>
            
                <li><a href="../classes/EvoSim.html">EvoSim</a></li>
            
                <li><a href="../classes/Gridster.html">Gridster</a></li>
            
                <li><a href="../classes/Time.html">Time</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: BotsEvolved/js/modules/botPrint/botApp.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * @author Kate Compton
 */

define([&quot;ui&quot;, &quot;./bot/bot&quot;, &quot;./physics/arena&quot;, &quot;threeUtils&quot;, &quot;./botEvo&quot;, &quot;app&quot;, &quot;common&quot;], function(UI, Bot, Arena, threeUtils, BotEvo, App, common) {

    var BotApp = App.extend({
        init : function() {
            var app = this;

            var w = 800;
            var h = 600;
            this.fullPanelDimensions = new Vector(w - 20, h - 40);

            app._super(&quot;Bots&quot;, new Vector(w, h));

            // app.changeMode(&quot;inspector&quot;);
            app.editBot();
            app.arena = new Arena();

            app.changeMode(&quot;arena&quot;);

            //   this.createAndTestNewBot();
            this.createAndTestManyBots();

            $(&quot;*&quot;).click(function(evt) {
                console.log(&quot;Clicked &quot;, this);
            });

        },

        createAndTestManyBots : function() {
            var task = &quot;doThing&quot;;
            var bots = [];
            var count = 5;
            for (var i = 0; i &lt; count; i++) {
                var bot = new Bot();
                bots[i] = bot;
            }
            app.currentBot = bots[0];

            app.arena.addPopulation(bots);

        },

        createAndTestNewBot : function() {
            var task = &quot;doThing&quot;;

            app.currentBot = new Bot();

            app.evoSim = new BotEvo.BrainEvo(app.currentBot, task, app.arena);
            var testBrain = app.evoSim.createIndividual(app.evoSim.createGenome());
            app.currentBot.setBrain(testBrain);
            app.arena.addPopulation([app.currentBot]);

            app.evoSim.treeViz.setTree(testBrain);
        },

        initModes : function() {

            var ui = app.ui;

            app.ui.addOption(&quot;drawWiring&quot;, false);
            app.ui.addOption(&quot;drawComponents&quot;, false);
            app.ui.addOption(&quot;logConditionTests&quot;, false);
            app.ui.addOption(&quot;logMutations&quot;, true);
            app.ui.addOption(&quot;useTimers&quot;, true);
            app.ui.addOption(&quot;useSharpie&quot;, false);
            app.ui.addTuningValue(&quot;unicornFluffiness&quot;, 100, 1, 700, function(key, value) {
                // do something on change
            });
            
            ui.addPanel({
                id : &quot;arena&quot;,
                div : $(&quot;#arena_panel&quot;),
                title : &quot;Arena&quot;,
                description : &quot;An arena to view bots in&quot;,
                side : &quot;right&quot;,
                sidePos : 5,
                dimensions : app.fullPanelDimensions

            });

            ui.addPanel({
                id : &quot;inspector&quot;,
                div : $(&quot;#inspector_panel&quot;),
                title : &quot;Inspector&quot;,
                description : &quot;A window to inspect and modify bots in&quot;,
                side : &quot;left&quot;,
                sidePos : 5,
                dimensions : app.fullPanelDimensions

            });

            ui.addPanel({
                id : &quot;threeRender&quot;,
                div : $(&quot;#render_panel&quot;),
                title : &quot;Render Panel&quot;,
                description : &quot;3D preview&quot;,
                side : &quot;top&quot;,
                sidePos : 5,
                dimensions : new Vector(200, 200),

            });

            ui.addPanel({
                id : &quot;scores&quot;,
                div : $(&quot;#scores_panel&quot;),
                title : &quot;Scores Panel&quot;,
                description : &quot;Current scores&quot;,
                side : &quot;top&quot;,
                sidePos : 5,
                dimensions : new Vector(400, 100),

            });

            // Create modes:
            // Each mode has some panels that only appear during that mode, and
            // Some custom control functionality

            this.modes = {
                arena : new UI.Mode({
                    title : &quot;arena&quot;,
                    panels : app.ui.getPanels([&quot;arena&quot;, &quot;scores&quot;]),

                }),

                inspector : new UI.Mode({
                    title : &quot;inspector&quot;,
                    panels : app.ui.getPanels([&quot;inspector&quot;, &quot;threeRender&quot;]),

                }),

            };

            $.each(this.modes, function(key, mode) {
                mode.id = key;
            });

        },

        initControls : function() {

            // Set all the default UI controls
            app.controls = new UI.Controls($(&quot;body&quot;), {

                onKeyPress : {
                    d : function(event) {
                        app.ui.devMode.toggle()
                    },
                },

            });

            // Make some of the windows touchable

            var touchRender = app.controls.addTouchable(&quot;threeRender&quot;, $(&quot;#render_panel&quot;));
            var touchInspector = app.controls.addTouchable(&quot;inspector&quot;, $(&quot;#inspector_canvas&quot;));
            var touchArena = app.controls.addTouchable(&quot;arena&quot;, $(&quot;#arena_canvas&quot;));

            // Camera Controls
            touchRender.onDrag(function(touchwindow, p) {
                var cam = app.threeRender.camera;
                cam.orbit.theta = p.x * -.003;
                cam.orbit.phi = -p.y * .004 + 1.7;
                cam.updateOrbit();

            });
            touchRender.onUp(function(touchwindow, p) {
                app.pauseSpinning = false;
            });

            touchRender.onDown(function(touchwindow, p) {
                app.pauseSpinning = true;
            });

            touchRender.onScroll(function(touchwindow, delta) {
                var cam = app.threeRender.camera;
                cam.orbit.distance *= 1 + .03 * delta;
                cam.orbit.distance = utilities.constrain(cam.orbit.distance, 300, 1200);
                cam.updateOrbit();

            });

            // Inspector controls
            touchInspector.onDrag(function(touchwindow, p) {
                var x = p.x - touchwindow.rect.w / 2;
                var y = p.y - touchwindow.rect.h / 2;
                // app.coin.designTransform.setTo(x, y, 0);
            });

            touchInspector.onMove(function(touchwindow, p) {
                //  get midPoint
                var x = p.x - touchwindow.rect.w / 2;
                var y = p.y - touchwindow.rect.h / 2;
                //  app.coin.selectAt(new Vector(x, y));

            });

        },

        initUI : function() {

            $(&quot;#test_button&quot;).click(function() {
                app.changeMode(&quot;arena&quot;);
            });

            $(&quot;#reset_arena&quot;).click(function() {
                app.createAndTestNewBot();
            });

            $(&quot;#mutate&quot;).click(function() {
                console.log(&quot;-------------------------- &quot;);
                console.log(&quot;Mutating &quot;);
                app.currentBot.brain.defaultTree.debugPrint();
                app.evoSim.mutateGenome(app.currentBot.brain.defaultTree);

                app.evoSim.treeViz.setTree(app.currentBot.brain.defaultTree);
                console.log(&quot;defaultTree after: &quot;, app.currentBot.brain.defaultTree)

            });

            $(&quot;#mutateBig&quot;).click(function() {
                console.log(&quot;-------------------------- &quot;);
                console.log(&quot;Mutating Generations&quot;);
                app.evoSim.runGenerations(2);
                /*
                 app.currentBot.brain.defaultTree.debugPrint();
                 for (var i = 0; i &lt; 20; i++) {
                 app.evoSim.mutateGenome(app.currentBot.brain.defaultTree);
                 }

                 app.evoSim.treeViz.setTree(app.currentBot.brain.defaultTree);
                 app.currentBot.brain.defaultTree.debugPrint();
                 */
            });

            $(&quot;#spawnRelatives&quot;).click(function() {
                console.log(&quot;Spawn relatives&quot;);
                var bots = [];
                // Create relatives
                console.log(app.currentBot.clone());
                for (var i = 0; i &lt; 10; i++) {
                    bots[i] = app.currentBot.clone();
                    // bots[i].mutate(.7);
                }
                app.arena.addPopulation(bots);
            });

            var ui = this.ui;

            $(&quot;.full_canvas&quot;).css({
                width : &quot;800px&quot;,
                height : &quot;600px&quot;,
            });

            // Create the Three scene
            app.threeRender = new threeUtils.ThreeView($(&quot;#render_panel&quot;), function() {
                // update the camera

                if (!app.pauseSpinning) {
                    this.camera.orbit.theta += .01;

                    this.camera.orbit.phi = .93;
                }
                // app.log(this.camera.orbit.theta);
                this.camera.updateOrbit();

            });

            // Initial camera settings
            var cam = app.threeRender.camera;
            cam.orbit.distance = 600;
            cam.updateOrbit();

            app.threeWindow = new UI.DrawingWindow(&quot;3D Bot View&quot;, $(&quot;#render_panel&quot;));

            //create an empty container
            app.threeBotMesh = new THREE.Object3D();
            app.threeRender.scene.add(app.threeBotMesh);

            // These windows all use processing for the drawing
            app.inspectorWindow = new UI.DrawingWindow(&quot;inspector&quot;, $(&quot;#inspector_canvas&quot;));
            app.arenaWindow = new UI.DrawingWindow(&quot;arena&quot;, $(&quot;#arena_canvas&quot;));
            app.scoreWindow = new UI.DrawingWindow(&quot;score&quot;, $(&quot;#score_canvas&quot;));

            app.inspectorProcessing = ui.addProcessingWindow(app.inspectorWindow.element, function(g) {
                app.inspectorWindow.setProcessing(g);

            }, function(g) {
                // Updates

                // only do if its the inspector mode
                if (app.mode === app.modes.inspector) {
                    // Updates

                    app.worldTime.updateTime(g.millis() * .001);
                    app.currentBot.update(app.time);

                    app.inspectorWindow.render(function(context) {
                        context.useChassisCurves = true;
                        app.currentBot.render(context);
                    });
                }
            });

            // Create the arena
            app.arenaProcessing = ui.addProcessingWindow(app.arenaWindow.element, function(g) {
                app.arenaWindow.setProcessing(g);
            }, function(g) {

                // only do if its the arena mode
                if (app.mode === app.modes.arena) {
                    app.worldTime.updateTime(g.millis() * .001);

                    app.arena.update(app.worldTime.ellapsed);

                    app.arenaWindow.render(function(context) {
                        app.arena.render(context);
                    });
                }

            });

            // Create the arena
            app.scoreProcessing = ui.addProcessingWindow(app.scoreWindow.element, function(g) {
                app.scoreWindow.setProcessing(g);
            }, function(g) {

                // only do if its the arena mode
                if (app.mode === app.modes.arena &amp;&amp; app.evoSim) {
                    g.background(.8, 1, .3);
                    app.evoSim.renderScores(g);

                }

            });

        },

        editBot : function(bot) {
            app.changeMode(&quot;inspector&quot;);

            if (bot === undefined)
                bot = new Bot();

            app.currentBot = bot;
            app.threeBotMesh.add(bot.createThreeMesh());

        },
    });

    return BotApp;
});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
